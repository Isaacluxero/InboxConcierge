// Prisma schema for Inbox Concierge

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // extensions = [vector]  // Temporarily disabled for Railway deployment
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  googleId      String   @unique
  accessToken   String   @db.Text
  refreshToken  String   @db.Text
  tokenExpiry   DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  emails        Email[]
  buckets       Bucket[]
}

model Email {
  id            String                     @id @default(uuid())
  userId        String
  gmailId       String
  subject       String
  sender        String
  senderEmail   String
  preview       String                     @db.Text
  receivedAt    DateTime
  bucketId      String?
  bodySnippet   String?                    @db.Text
  searchVector  String?                    @db.Text
  // embedding     Unsupported("vector(1536)")?  // Temporarily disabled for Railway deployment

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  bucket        Bucket?  @relation(fields: [bucketId], references: [id], onDelete: SetNull)

  @@unique([userId, gmailId])
  @@index([userId, bucketId])
  @@index([userId, receivedAt])
}

model Bucket {
  id            String   @id @default(uuid())
  userId        String
  name          String
  description   String?
  isDefault     Boolean  @default(false)
  color         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  emails        Email[]

  @@unique([userId, name])
  @@index([userId])
}
